---
import GuideLayout from '../../layouts/GuideLayout.astro';

const toc = [
  { title: 'Introduction', href: '#introduction' },
  { title: 'Getting Started', href: '#getting-started' },
  { title: 'Core Concepts', href: '#core-concepts' },
  { title: 'Building APIs with Express', href: '#express' },
  { title: 'Working with Files', href: '#files' },
  { title: 'Database Integration', href: '#database' },
  { title: 'Async Patterns', href: '#async' },
  { title: 'Best Practices', href: '#best-practices' }
];
---

<GuideLayout
  title="Node.js: Server-Side JavaScript"
  description="Learn Node.js for backend development. Build APIs, work with databases, handle files, and create scalable server-side applications with JavaScript."
  level="intermediate"
  readTime="30 min read"
  datePublished="2024-12-01"
  lastUpdated="December 2024"
  toc={toc}
>
  <p class="intro">
    Node.js allows you to run JavaScript on the server. It's the foundation of modern full-stack JavaScript
    development, powering everything from simple APIs to Netflix's streaming platform.
  </p>

  <h2 id="introduction">What is Node.js?</h2>
  <p>
    Node.js is a JavaScript runtime built on Chrome's V8 engine. It enables JavaScript to run outside
    the browser, making it possible to build servers, command-line tools, and more.
  </p>

  <h3>Why Node.js?</h3>
  <ul>
    <li><strong>JavaScript everywhere:</strong> Use one language for frontend and backend</li>
    <li><strong>Non-blocking I/O:</strong> Handle thousands of concurrent connections efficiently</li>
    <li><strong>npm ecosystem:</strong> Access millions of open-source packages</li>
    <li><strong>Fast development:</strong> Quick to prototype and iterate</li>
    <li><strong>Great for real-time:</strong> WebSockets, chat apps, live updates</li>
  </ul>

  <h2 id="getting-started">Getting Started</h2>

  <h3>Installation</h3>
  <p>Download Node.js from <a href="https://nodejs.org" target="_blank" rel="noopener">nodejs.org</a> or use a version manager:</p>
  <pre><code>{`# Check installation
node --version  # Should show v18.x or higher
npm --version   # Node Package Manager

# Run JavaScript files
node app.js

# Start interactive REPL
node`}</code></pre>

  <h3>Your First Node.js Script</h3>
  <pre><code>{`// hello.js
console.log('Hello from Node.js!');

// Access command line arguments
console.log('Arguments:', process.argv);

// Environment variables
console.log('Node version:', process.version);
console.log('Current directory:', process.cwd());`}</code></pre>

  <h3>npm Basics</h3>
  <pre><code>{`# Initialize a new project
npm init -y

# Install dependencies
npm install express        # Production dependency
npm install nodemon -D     # Development dependency

# Run scripts defined in package.json
npm run dev
npm start`}</code></pre>

  <h2 id="core-concepts">Core Concepts</h2>

  <h3>Modules</h3>
  <pre><code>{`// math.js - Export functions
export function add(a, b) {
  return a + b;
}

export function multiply(a, b) {
  return a * b;
}

// app.js - Import and use
import { add, multiply } from './math.js';

console.log(add(2, 3));       // 5
console.log(multiply(4, 5));  // 20`}</code></pre>

  <h3>Built-in Modules</h3>
  <table>
    <thead>
      <tr>
        <th>Module</th>
        <th>Purpose</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>fs</code></td>
        <td>File system operations</td>
      </tr>
      <tr>
        <td><code>path</code></td>
        <td>File path utilities</td>
      </tr>
      <tr>
        <td><code>http</code></td>
        <td>HTTP server and client</td>
      </tr>
      <tr>
        <td><code>crypto</code></td>
        <td>Cryptographic functions</td>
      </tr>
      <tr>
        <td><code>os</code></td>
        <td>Operating system info</td>
      </tr>
    </tbody>
  </table>

  <h3>Creating a Basic HTTP Server</h3>
  <pre><code>{`import http from 'http';

const server = http.createServer((req, res) => {
  res.writeHead(200, { 'Content-Type': 'text/plain' });
  res.end('Hello, World!');
});

server.listen(3000, () => {
  console.log('Server running at http://localhost:3000');
});`}</code></pre>

  <h2 id="express">Building APIs with Express</h2>
  <p>
    Express is the most popular Node.js web framework. It simplifies building APIs and web applications.
  </p>

  <h3>Basic Express Setup</h3>
  <pre><code>{`import express from 'express';

const app = express();

// Middleware to parse JSON
app.use(express.json());

// Routes
app.get('/', (req, res) => {
  res.json({ message: 'Welcome to the API' });
});

app.get('/users', (req, res) => {
  res.json([
    { id: 1, name: 'Alice' },
    { id: 2, name: 'Bob' }
  ]);
});

app.post('/users', (req, res) => {
  const { name, email } = req.body;
  // Save to database...
  res.status(201).json({ id: 3, name, email });
});

app.listen(3000, () => {
  console.log('Server running on port 3000');
});`}</code></pre>

  <h3>Route Parameters & Query Strings</h3>
  <pre><code>{`// Route parameters - /users/123
app.get('/users/:id', (req, res) => {
  const userId = req.params.id;
  res.json({ id: userId, name: 'User ' + userId });
});

// Query strings - /search?q=node&limit=10
app.get('/search', (req, res) => {
  const { q, limit = 10 } = req.query;
  res.json({ query: q, limit: parseInt(limit) });
});`}</code></pre>

  <h3>Middleware</h3>
  <pre><code>{`// Logging middleware
const logger = (req, res, next) => {
  console.log(\`\${req.method} \${req.path}\`);
  next();  // Continue to next middleware
};

app.use(logger);

// Error handling middleware
app.use((err, req, res, next) => {
  console.error(err.stack);
  res.status(500).json({ error: 'Something went wrong!' });
});`}</code></pre>

  <h2 id="files">Working with Files</h2>
  <pre><code>{`import fs from 'fs/promises';
import path from 'path';

// Read file
const content = await fs.readFile('data.txt', 'utf-8');
console.log(content);

// Write file
await fs.writeFile('output.txt', 'Hello, World!');

// Append to file
await fs.appendFile('log.txt', 'New log entry\\n');

// Check if file exists
try {
  await fs.access('config.json');
  console.log('File exists');
} catch {
  console.log('File does not exist');
}

// Read directory
const files = await fs.readdir('./src');
console.log(files);

// Create directory
await fs.mkdir('uploads', { recursive: true });`}</code></pre>

  <h2 id="database">Database Integration</h2>

  <h3>MongoDB with Mongoose</h3>
  <pre><code>{`import mongoose from 'mongoose';

// Connect to MongoDB
await mongoose.connect('mongodb://localhost:27017/myapp');

// Define a schema
const userSchema = new mongoose.Schema({
  name: { type: String, required: true },
  email: { type: String, unique: true },
  createdAt: { type: Date, default: Date.now }
});

const User = mongoose.model('User', userSchema);

// CRUD operations
const user = await User.create({ name: 'Alice', email: 'alice@example.com' });
const users = await User.find();
const found = await User.findById(user._id);
await User.findByIdAndUpdate(user._id, { name: 'Alicia' });
await User.findByIdAndDelete(user._id);`}</code></pre>

  <h3>PostgreSQL with Prisma</h3>
  <pre><code>{`import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

// Create user
const user = await prisma.user.create({
  data: { name: 'Alice', email: 'alice@example.com' }
});

// Find users
const users = await prisma.user.findMany({
  where: { name: { contains: 'Ali' } }
});

// Update user
await prisma.user.update({
  where: { id: 1 },
  data: { name: 'Alicia' }
});`}</code></pre>

  <h2 id="async">Async Patterns</h2>

  <h3>Promises and Async/Await</h3>
  <pre><code>{`// Async function
async function fetchData() {
  try {
    const response = await fetch('https://api.example.com/data');
    const data = await response.json();
    return data;
  } catch (error) {
    console.error('Fetch failed:', error);
    throw error;
  }
}

// Parallel execution
async function fetchMultiple() {
  const [users, posts] = await Promise.all([
    fetch('/api/users').then(r => r.json()),
    fetch('/api/posts').then(r => r.json())
  ]);
  return { users, posts };
}

// Error handling with Promise.allSettled
const results = await Promise.allSettled([
  fetch('/api/fast'),
  fetch('/api/slow'),
  fetch('/api/might-fail')
]);
// results contain status: 'fulfilled' or 'rejected'`}</code></pre>

  <h2 id="best-practices">Best Practices</h2>

  <h3>Environment Variables</h3>
  <pre><code>{`// Use dotenv for local development
import 'dotenv/config';

const port = process.env.PORT || 3000;
const dbUrl = process.env.DATABASE_URL;

// Never commit secrets to git!
// .env file (add to .gitignore)
// PORT=3000
// DATABASE_URL=mongodb://localhost:27017/myapp
// JWT_SECRET=your-secret-key`}</code></pre>

  <h3>Project Structure</h3>
  <pre><code>{`my-api/
├── src/
│   ├── routes/        # Route handlers
│   ├── controllers/   # Business logic
│   ├── models/        # Database models
│   ├── middleware/    # Custom middleware
│   ├── utils/         # Helper functions
│   └── index.js       # Entry point
├── tests/             # Test files
├── .env               # Environment variables
├── .gitignore
└── package.json`}</code></pre>

  <h3>Security Tips</h3>
  <ul>
    <li><strong>Validate input:</strong> Never trust user input, use validation libraries</li>
    <li><strong>Use HTTPS:</strong> Encrypt data in transit</li>
    <li><strong>Hash passwords:</strong> Use bcrypt, never store plain text</li>
    <li><strong>Rate limiting:</strong> Prevent abuse and DDoS attacks</li>
    <li><strong>Helmet:</strong> Set security headers automatically</li>
  </ul>

  <h3>Related Guides</h3>
  <ul>
    <li><a href="/guides/javascript">JavaScript Fundamentals</a></li>
    <li><a href="/guides/databases">Databases Guide</a></li>
    <li><a href="/guides/api-design">API Design</a></li>
  </ul>

  <style>
    .intro {
      font-size: 1.125rem;
      color: var(--color-text-muted);
      border-left: 4px solid var(--color-primary);
      padding-left: 1rem;
      margin-bottom: 2rem;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin: 1.5rem 0;
    }

    th, td {
      padding: 0.75rem;
      text-align: left;
      border-bottom: 1px solid var(--color-border);
    }

    th {
      background: var(--color-bg-alt);
      font-weight: 600;
    }
  </style>
</GuideLayout>
